<!DOCTYPE html>
<html lang="zh"><head>
<title>一次开发LLM应用的尝试</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="一次开发LLM应用的尝试" />
<meta property="og:description" content="LLM-based Animation应用的开发笔记" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://eimy.ink/posts/2024/llm-app-dev/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-21T09:33:57+08:00" />
<meta property="article:modified_time" content="2024-05-21T09:33:57+08:00" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="一次开发LLM应用的尝试"/>
<meta name="twitter:description" content="LLM-based Animation应用的开发笔记"/>











  




<link rel="icon" href="http://eimy.ink/favicons/favicon.ico">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.1b8d756f5775440d933c9656c9e438b615102519cb3d0c904c91deeaea446782.css" integrity="sha256-G411b1d1RA2TPJZWyeQ4thUQJRnLPQyQTJHe6upEZ4I=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">

















<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/noto-serif-sc@5.2.8/index.css">
<link rel="stylesheet" href="/css/custom-font.css">
<link rel="stylesheet" href="/css/custom-texture.css">


</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/archives/">
                    归档
                </a>
                
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories/">
                    分类
                </a>
                
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags/">
                    标签
                </a>
                
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/search/">
                    搜索
                </a>
                
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/about/">
                    关于
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%a1%b9%e7%9b%ae%e4%bb%8b%e7%bb%8d" class="nav-项目介绍">
									项目介绍
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%a1%b9%e7%9b%ae%e6%8a%80%e6%9c%af" class="nav-项目技术">
									项目技术
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%80%e5%8f%91%e8%bf%87%e7%a8%8b%e4%b8%ad%e7%9a%84%e6%8c%91%e6%88%98%e8%a7%a3%e5%86%b3" class="nav-开发过程中的挑战解决">
									开发过程中的挑战&amp;解决
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%90%8e%e7%ab%af" class="nav-后端">
									后端
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%89%8d%e7%ab%af" class="nav-前端">
									前端
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%ae%80%e7%9f%ad%e7%9a%84%e6%84%9f%e6%83%b3" class="nav-简短的感想">
									简短的感想
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="http://eimy.ink/">
            EIMY
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="http://eimy.ink/">
        <div class="single-column-header-title">EIMY</div>
        
        <div class="single-column-header-subtitle">The dots will connect.</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    一次开发LLM应用的尝试
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-05-21 09:33
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[笔记]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/%E5%BC%80%E5%8F%91">开发</a>
                                &nbsp;
                            
                                <a href="/tags/llm">LLM</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>最近参与了一个HCI实验室项目的LLM应用开发部分，在不涉及敏感信息的前提下记录点开发过程和感想。</p>
<h2 id="项目介绍">项目介绍</h2>
<p>项目目的和conceptual的说明略，只能讲讲技术性的东西。</p>
<p>这个应用的主要功能是「将用户输入的故事文本初步转化为动画，并允许用户个性化修改」。</p>
<p>下面是简陋的前端页面1和2：</p>
<ul>
<li>第一页提供「chatbot辅助撰写故事」和「AI故事拆分」的功能。后者可以一键把一个较长的故事拆分成几个剧情段落，以方便后续动画生成，也是基于llm实现。</li>
<li>第二页是一个动画编辑器。在进入这一页时，应用会自动把上一页生成完毕的动画元素摆放在画布相应位置（即提供动画的初稿），用户可以按需自行添加、修改元素，最后通过右下角导出视频。</li>
</ul>
<p><img src="./index.assets/enter-prompt-to-segment.png" alt="enter-prompt-to-segment"></p>
<img src="./index.assets/editor-auto-position.png" alt="editor-auto-position" style="zoom:50%;" />
<h2 id="项目技术">项目技术</h2>
<p>采用前后端分离，</p>
<ul>
<li>
<p>后端基于Python+Django框架，MongoDB作为数据库，用celery库实现异步任务；最开始使用GPT3.5作为文本生成的模型，后因合规性问题转为某开源LLM</p>
</li>
<li>
<p>前端整体基于React.js，动画编辑器的部分因没有合适组件，整合了一个开源但技术略老旧的编辑器网页（html/css/js三件套）</p>
</li>
</ul>
<h2 id="开发过程中的挑战解决">开发过程中的挑战&amp;解决</h2>
<h3 id="后端">后端</h3>
<p>原先觉得处理第三方llm api的部分会比较麻烦，毕竟之前没有接触过，外加llm的对话性质必然牵涉到一些项目里的异步处理。但后来因为和pm了解了下发现项目体量暂时不大&amp;只是demo阶段，没有分布式问题，所以可以省略很多不必要技术处理，于是这部分倒是很快地处理完了。</p>
<p>实际开工后发现真正的难点在prompt engineering。这个应用总共涉及到两次调api做文本生成：</p>
<ul>
<li>第一次是把完整的故事文本拆分为几个情节段落（story to plots），每个plot包括剧情简述、出场人物、背景/环境设定、道具；</li>
<li>第二次是把每个plot转化为可以摆放在画布上的动画元素信息（plot to elements），信息需要包括大小、位置等。</li>
</ul>
<p>第一个任务没什么问题，因为文本分析还算是大模型的舒适区内的事情。</p>
<p>但是在调第二个任务时明显感觉到很难用它来做位置推理。</p>
<p>一方面，llm直接生成的位置相当零乱。尝试了很多办法以后，觉得能提高效果的是更精细化的prompt——prompt中带有位置区间的constraint + 文字表述要求的大致位置区间 + 位置区间的数字定义（x 到 y之间算bottom-left），然后给出一些例子。</p>
<p>另一方面，对于性能一般的大模型，在调prompt时需要考虑一些trade off，如果一次性给出过量文本指示，其中一部分细节会被遗漏；但是如果要分段提供，又会大幅增加响应ie用户等待的时间。</p>
<img src="./index.assets/image-20240521102930779.png" alt="image-20240521102930779" style="zoom:50%;" />
<p>Prompt engineering的问题，最终也没有非常完美的解决，只能说在model自身实现突破前尽量平衡上述问题。</p>
<h3 id="前端">前端</h3>
<p>前文也有提到，动画编辑器的部分因没有合适React组件，搜遍各种开源仓库也只找到一个三件套技术栈的静态网页，于是问题就变成了怎么把这个静态网页融入React项目。</p>
<p>最开始考虑的是把动画编辑器组件化，但是编辑器的源代码太过于臃肿混乱（说实话，这个代码仓库是谁看谁无语的屎山程度），我的判断是尽量只增不减，避免refactor。由此知道组件化是完全没可能的。</p>
<p>最后无奈只能把编辑器项目放在react的静态资源目录里，而两个网页之间的数据沟通通过localStorage实现。目前显然是在数据传输的security上做出了妥协，这里可以优化的地方可能是改成url+加密的方式。</p>
<h2 id="简短的感想">简短的感想</h2>
<p>这算是一个explorative project，对我来说最大的启发是位置生成的部分。仔细想想，「故事拆分」和「图像/视频生成」都是非常常见的应用，但是通过「位置信息生成」来连接这两个部分（ie纯文本和纯视觉）的模式（而不是通过多模态的模型直接实现）这点对我来说还是挺新奇的。最后是一些有端畅想：「连通」从历史角度来说是个意义重大的词，虽然现在感觉还不太成熟，但看样子未来会有更多有趣的发展。</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2024-05-21</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/2024/recent-jun/">
			下回<br>近况乱报 · 六月刊
                </a>
                
                
                
                <a class="older-posts" href="/posts/2024/half-year-review/">
			上回<br>一份人生管理实验报告（2023.6～2024.2）
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="http://eimy.ink/">
    
        <div class="nav-title">
            EIMY
        </div>
        
        <div class="nav-subtitle">
            The dots will connect.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            <a class="a-block nav-link-item false" href="/archives/">
                归档
            </a>
            
        
            
            
            
            <a class="a-block nav-link-item false" href="/categories/">
                分类
            </a>
            
        
            
            
            
            <a class="a-block nav-link-item false" href="/tags/">
                标签
            </a>
            
        
            
            
            
            <a class="a-block nav-link-item false" href="/search/">
                搜索
            </a>
            
        
            
            
            
            <a class="a-block nav-link-item false" href="/about/">
                关于
            </a>
            
        
    </div>

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2026 EIMY
	

    </div>
</div>
<div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%a1%b9%e7%9b%ae%e4%bb%8b%e7%bb%8d" class="nav-项目介绍">
									项目介绍
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%a1%b9%e7%9b%ae%e6%8a%80%e6%9c%af" class="nav-项目技术">
									项目技术
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%80%e5%8f%91%e8%bf%87%e7%a8%8b%e4%b8%ad%e7%9a%84%e6%8c%91%e6%88%98%e8%a7%a3%e5%86%b3" class="nav-开发过程中的挑战解决">
									开发过程中的挑战&amp;解决
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%90%8e%e7%ab%af" class="nav-后端">
									后端
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%89%8d%e7%ab%af" class="nav-前端">
									前端
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%ae%80%e7%9f%ad%e7%9a%84%e6%84%9f%e6%83%b3" class="nav-简短的感想">
									简短的感想
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2026 EIMY
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
