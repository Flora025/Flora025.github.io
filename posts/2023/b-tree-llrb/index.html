<!DOCTYPE html>
<html lang="zh"><head>
<title>61B Notes - B-Trees &amp; LLRB</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="61B Notes - B-Trees &amp; LLRB" />
<meta property="og:description" content="B树と旋转と红黑色树" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://eimy.ink/posts/2023/b-tree-llrb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-28T22:36:43+08:00" />
<meta property="article:modified_time" content="2023-03-28T22:36:43+08:00" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="61B Notes - B-Trees &amp; LLRB"/>
<meta name="twitter:description" content="B树と旋转と红黑色树"/>











  




<link rel="icon" href="http://eimy.ink/favicons/favicon.ico">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.1b8d756f5775440d933c9656c9e438b615102519cb3d0c904c91deeaea446782.css" integrity="sha256-G411b1d1RA2TPJZWyeQ4thUQJRnLPQyQTJHe6upEZ4I=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">

















<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/noto-serif-sc@5.2.8/index.css">
<link rel="stylesheet" href="/css/custom-font.css">
<link rel="stylesheet" href="/css/custom-texture.css">


</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/archives/">
                    归档
                </a>
                
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories/">
                    分类
                </a>
                
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags/">
                    标签
                </a>
                
            
                
                
                
                <a class="a-block drawer-menu-item false" href="/about/">
                    关于
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#b-tree-llrb" class="nav-b-tree-llrb">
									B-Tree, LLRB
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bst%e7%9a%84%e5%b1%80%e9%99%90" class="nav-bst的局限">
									BST的局限
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#b-trees--2-3-trees--2-3-4-trees" class="nav-b-trees--2-3-trees--2-3-4-trees">
									B-Trees / 2-3 trees / 2-3-4 trees
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%9a%e4%b9%89" class="nav-定义">
									定义
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9e%84%e6%88%90%e6%9c%ba%e5%88%b6" class="nav-构成机制">
									构成机制
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%a7%e8%b4%a8" class="nav-性质">
									性质
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#runtime-analysis" class="nav-runtime-analysis">
									Runtime Analysis
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#b-tree%e7%9a%84%e5%b1%80%e9%99%90" class="nav-b-tree的局限">
									B-Tree的局限
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#left-leaning-red-black-trees" class="nav-left-leaning-red-black-trees">
									Left Leaning Red-Black Trees
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%9a%e4%b9%89-1" class="nav-定义-1">
									定义
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%a7%e8%b4%a8-1" class="nav-性质-1">
									性质
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9e%84%e6%88%90%e6%9c%ba%e5%88%b6-1" class="nav-构成机制-1">
									构成机制
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" class="nav-代码实现">
									代码实现
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#runtime-analysis-1" class="nav-runtime-analysis-1">
									Runtime Analysis
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#summary-of-search-trees" class="nav-summary-of-search-trees">
									Summary of search trees
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%80%bb%e8%be%91%e6%a2%b3%e7%90%86" class="nav-逻辑梳理">
									逻辑梳理
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#complexityruntime%e5%af%b9%e6%af%94" class="nav-complexityruntime对比">
									Complexity/runtime对比
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="http://eimy.ink/">
            EIMY
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="http://eimy.ink/">
        <div class="single-column-header-title">EIMY</div>
        
        <div class="single-column-header-subtitle">The dots will connect.</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    61B Notes - B-Trees &amp; LLRB
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2023-03-28 22:36
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[笔记]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="b-tree-llrb">B-Tree, LLRB</h1>
<p>Hug一般会顺滑地衔接/引入知识点，但这些衔接部分写在笔记里多少有点啰嗦，所以这里会略写。</p>
<h2 id="bst的局限">BST的局限</h2>
<ul>
<li>先引入两个BST的属性：height和average depth
<ul>
<li>height：determines the <strong>worst case runtime</strong> to find a node</li>
<li>average depth：determines the <strong>average case runtime</strong> to find a node</li>
</ul>
</li>
</ul>
<center>
<img style="border-radius: 0.3125em;
 box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);zoom:40%;" 
 src="./B-Tree-LLRB.assets/image-20230328095936843.png">
</center>
<ul>
<li>然后看看BST的各种属性
<ul>
<li>Worst case $ \Theta( N)$ height</li>
<li>Best case $ \Theta(log N)$ height</li>
<li>Random trees have $ \Theta(log N)$ average depth and height (bushy)</li>
</ul>
</li>
<li>随机情况下表现还不错，问题是现实中会不断从右边insert数据，这会导致不平衡，比如
<ul>
<li>add(“01-Jan-2019, 10:31:00”)</li>
<li>add(“01-Jan-2019, 18:51:00”)</li>
</ul>
</li>
</ul>
<h2 id="b-trees--2-3-trees--2-3-4-trees">B-Trees / 2-3 trees / 2-3-4 trees</h2>
<p>接上，为了防止不平衡，我们不断把新的key insert进原来的node中，然后进行node splitting。</p>
<p>于是就出现了新的树B-trees。</p>
<blockquote>
<p>B-trees should be called juicy trees.</p>
</blockquote>
<h3 id="定义">定义</h3>
<ul>
<li>B-tree是一种自平衡树，总的分为以下几类：
<ul>
<li>B-trees of order L=3 (like we used today) are also called a <strong>2-3-4 tree</strong> or a 2-4 tree（如图）</li>
<li>B-trees of order L=2 are also called a <strong>2-3 tree</strong> （如图）</li>
<li>B-trees of large L are used in practice for databases etc.</li>
</ul>
</li>
</ul>
<img src="./B-Tree-LLRB.assets/image-20230328102217909.png#center" alt="image-20230328102217909" style="zoom:50%;" />
<h3 id="构成机制">构成机制</h3>
<p>（node-split）</p>
<ul>
<li>
<p>1/ Insert into a leaf until the number of keys exceeds L</p>
</li>
<li>
<p>2/ In case of excessive keys, send the second (1 st) node up, and split the node</p>
</li>
</ul>
<p>几个例子：</p>
<center>【非连锁反应】</center>
<center>
<img style="border-radius: 0.3125em;
 box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);zoom:40%;" 
 src="./B-Tree-LLRB.assets/image-20230328103007573.png">
</center>
<center>【涉及到连锁反应】</center>
<center>
<img style="border-radius: 0.3125em;
 box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);zoom:40%;" 
 src="./B-Tree-LLRB.assets/image-20230328103228293.png">
</center>
<center>【涉及到root split】</center>
<center>
<img style="border-radius: 0.3125em;
 box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);zoom:40%;" 
 src="./B-Tree-LLRB.assets/image-20230328103520808.png">
</center>
<h3 id="性质">性质</h3>
<p>（or Invariants）</p>
<p>基于以上构成机制，可以得出B-tree的一些性质。B-trees are balanced in that:</p>
<ul>
<li>
<p>All leaves must be the same distance from the source</p>
<ul>
<li>考虑：涉及到root-split，height+1，所有node都会下降一层；</li>
<li>如不涉及root-split，height不变</li>
</ul>
</li>
<li>
<p>A <strong>non-leaf node</strong> with k items must have exactly <strong>k+1 children</strong></p>
</li>
</ul>
<h3 id="runtime-analysis">Runtime Analysis</h3>
<ul>
<li>Height：Θ(log N) for both worst cast and best case
<ul>
<li>best case是每个node都有L个items（满的） $\Rightarrow$ Height grows with $\Theta(log_{L+1}N)$</li>
<li>worst case是每个node只有1个item $\Rightarrow$ 所以和BST一样Height grows with $\Theta(log_2N)$</li>
</ul>
</li>
<li>operation runtime: <code>contains()</code> and <code>add()</code> are both $O(log N)$
<ul>
<li>【worst case】<code>contains()</code>: $C = （层数）log_{L+1}{N} \space·\space （node \space per \space layer）1 \space·\space （work \space per \space node）L$</li>
<li>【worst case】<code>add()</code>: 多了一些split operation，但化简后是一样的</li>
</ul>
</li>
</ul>
<center>
<img style="border-radius: 0.3125em;
 box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);zoom:40%;" 
 src="./B-Tree-LLRB.assets/image-20230328115018100.png">
</center>
<h3 id="b-tree的局限">B-Tree的局限</h3>
<blockquote>
<p>猜猜为什么上面没有代码实现部分</p>
</blockquote>
<h2 id="left-leaning-red-black-trees">Left Leaning Red-Black Trees</h2>
<h3 id="定义-1">定义</h3>
<p>A BST with left glue links that represents a 2-3 tree is often called a “Left Leaning Red Black Binary Search Tree” or LLRB</p>
<p>可以理解为：LLRB是一种和某一个B-Tree对应的BST。具体备注：</p>
<ul>
<li>LLRBs are normal BSTs!</li>
<li>There is a <strong>1-1 correspondence</strong> between an LLRB and an equivalent 2-3 tree.</li>
<li>The red is just a convenient fiction. Red links don’t “do” anything special</li>
</ul>
<h3 id="性质-1">性质</h3>
<p>和BST一样</p>
<p>尤其需要注意的几个性质：</p>
<ul>
<li>All leaves must be the same distance from the source（只数black links）</li>
<li>No node has two red links</li>
</ul>
<h3 id="构成机制-1">构成机制</h3>
<ul>
<li>原理上是基于2-3 tree，将node中较小的item下移，如</li>
</ul>
<center>
<img style="border-radius: 0.3125em;
 box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);zoom:40%;" 
 src="./B-Tree-LLRB.assets/image-20230328202825231.png">
</center>
<ul>
<li>
<p>实际上，因为不可能先实现2-3 tree，再调整成LLRB。在代码中会利用red link, rotate, flip color直接实现LLRB：</p>
<ul>
<li>
<p>always use a <strong>red link</strong> when inserting （类比在2-3中会先往node中添加item）</p>
<img src="./B-Tree-LLRB.assets/image-20230328211407567.png#center" alt="image-20230328211407567" style="zoom:50%;" />
</li>
<li>
<p>when inserting items <strong>on the right</strong>, rotateLeft()</p>
<img src="./B-Tree-LLRB.assets/image-20230328211424939.png#center" alt="image-20230328211424939" style="zoom:50%;" />
</li>
<li>
<p>when inserting <strong>on the left twice</strong>, rotateRight()</p>
<img src="./B-Tree-LLRB.assets/image-20230328212334776.png#center" alt="image-20230328212334776" style="zoom:50%;" />
</li>
<li>
<p>(a new rule) allows representing <strong>temporary 4-nodes</strong> as BST nodes with two red links</p>
<img src="./B-Tree-LLRB.assets/image-20230328212423779.png#center" alt="image-20230328212423779" style="zoom:50%;" />
</li>
<li>
<p>In case of tmp 4-nodes, flipcolor().</p>
</li>
<li>
<p>If a rotation or flip operation <strong>cause an additional violation</strong>, fix it</p>
<img src="./B-Tree-LLRB.assets/image-20230328213407205.png#center" alt="image-20230328213407205" style="zoom:50%;" />
<img src="./B-Tree-LLRB.assets/image-20230328213419511.png#center" alt="image-20230328213419511" style="zoom:50%;" />
</li>
</ul>
</li>
</ul>
<h3 id="代码实现">代码实现</h3>
<p>以下是这些方法的代码实现，包括调整过的Node Class、<code>put()</code>、新增的<code>rotate</code>系列、<code>flipColors()</code>和<code>isred()</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// LLRB insertion (p.439)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedBlackBST</span><span class="o">&lt;</span><span class="n">Key</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Key</span><span class="o">&gt;,</span> <span class="n">Value</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Node</span> <span class="n">root</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">Node</span> <span class="c1">// BST node with color bit (see page 433)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isRed</span><span class="o">(</span><span class="n">Node</span> <span class="n">h</span><span class="o">)</span>    <span class="c1">// See page 433.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">Node</span> <span class="nf">rotateLeft</span><span class="o">(</span><span class="n">Node</span> <span class="n">h</span><span class="o">)</span>  <span class="c1">// See page 434.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">Node</span> <span class="nf">rotateRight</span><span class="o">(</span><span class="n">Node</span> <span class="n">h</span><span class="o">)</span> <span class="c1">// See page 434.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">flipColors</span><span class="o">(</span><span class="n">Node</span> <span class="n">h</span><span class="o">)</span>  <span class="c1">// See page 436.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span>               <span class="c1">// See page 398.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">Key</span> <span class="n">key</span><span class="o">,</span> <span class="n">Value</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">        <span class="c1">// Search for key. Update value if found; grow table if new.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">root</span> <span class="o">=</span> <span class="n">put</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">root</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">BLACK</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Node</span> <span class="nf">put</span><span class="o">(</span><span class="n">Node</span> <span class="n">h</span><span class="o">,</span> <span class="n">Key</span> <span class="n">key</span><span class="o">,</span> <span class="n">Value</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>  <span class="o">{</span> <span class="c1">// Do standard insert, with red link to parent.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="k">return</span> <span class="k">new</span> <span class="n">Node</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">val</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">RED</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">cmp</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">cmp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">h</span><span class="o">.</span><span class="na">left</span>  <span class="o">=</span> <span class="n">put</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">,</span>  <span class="n">key</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">cmp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">h</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="n">put</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">h</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">if</span> <span class="o">(</span><span class="n">isRed</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">right</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isRed</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// 基于BST只需要修改这里三个clause
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">h</span> <span class="o">=</span> <span class="n">rotateLeft</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">if</span> <span class="o">(</span><span class="n">isRed</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">isRed</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">left</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">h</span> <span class="o">=</span> <span class="n">rotateRight</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">if</span> <span class="o">(</span><span class="n">isRed</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">isRed</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">right</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">flipColors</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">h</span><span class="o">.</span><span class="na">N</span> <span class="o">=</span> <span class="n">size</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">)</span> <span class="o">+</span> <span class="n">size</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">right</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">h</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// some omitted methods within RedBlackBST Class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isRed</span><span class="o">(</span><span class="n">Node</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="na">color</span> <span class="o">==</span> <span class="n">RED</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Node</span> <span class="nf">rotateLeft</span><span class="o">(</span><span class="n">Node</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// rotateRight() is similar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>       <span class="n">Node</span> <span class="n">x</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="na">right</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">h</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="na">left</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">x</span><span class="o">.</span><span class="na">left</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">x</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="na">color</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">h</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">RED</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">x</span><span class="o">.</span><span class="na">N</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="na">N</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">h</span><span class="o">.</span><span class="na">N</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">size</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">               <span class="o">+</span> <span class="n">size</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">right</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">flipColors</span><span class="o">(</span><span class="n">Node</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">h</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">RED</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">h</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">BLACK</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">h</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">BLACK</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// delete比较麻烦，详细见p.441.
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="runtime-analysis-1">Runtime Analysis</h3>
<ul>
<li>Height:  $O(logN)$</li>
<li><code>contains()</code>:  $O(logN)$</li>
<li><code>insert()</code>:  $O(logN)$
<ul>
<li>$O(logN)$  to add the new node</li>
<li>$O(logN)$  for rotation and color flip operations per insert （化简后忽略常数 所以还是 $O(logN)$）</li>
</ul>
</li>
</ul>
<h2 id="summary-of-search-trees">Summary of search trees</h2>
<h3 id="逻辑梳理">逻辑梳理</h3>
<blockquote>
<p>Cited from the slides [lec 18, 19sp]</p>
</blockquote>
<ul>
<li>
<p>Binary search trees** are simple, but they are subject to imbalance.</p>
</li>
<li>
<p><strong>2-3 Trees (B Trees)</strong> are balanced, but painful to implement and relatively slow.</p>
</li>
<li>
<p><strong>LLRBs</strong> insertion is simple to implement (but delete is hard).</p>
<ul>
<li>Works by maintaining mathematical bijection with a 2-3 trees.</li>
</ul>
</li>
<li>
<p>Java’s TreeMap is a red-black tree (not left leaning).</p>
<ul>
<li>
<p>Maintains correspondence with 2-3-4 tree (is not a 1-1 correspondence).</p>
</li>
<li>
<p>Allows glue links on either side (see Red-Black Tree).</p>
</li>
<li>
<p>More complex implementation, but significantly (?) faster.</p>
</li>
</ul>
</li>
</ul>
<h3 id="complexityruntime对比">Complexity/runtime对比</h3>
<p>WC = worst case</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">BST</th>
<th style="text-align:center">B-Trees</th>
<th style="text-align:center">LLRB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Height</strong></td>
<td style="text-align:center">$O(logN)$</td>
<td style="text-align:center">$\Theta(logN)$</td>
<td style="text-align:center">$O(logN)$</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">WC：$O(N)$</td>
<td style="text-align:center">WC：$O(log N)$</td>
<td style="text-align:center">WC：$O(log N)$</td>
</tr>
<tr>
<td style="text-align:center"><code>contains()</code></td>
<td style="text-align:center">$O(logN)$</td>
<td style="text-align:center">$O(log N)$</td>
<td style="text-align:center">$O(logN)$</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">WC：$O(N)$</td>
<td style="text-align:center">WC：$O(log N)$</td>
<td style="text-align:center">WC：$O(log N)$</td>
</tr>
<tr>
<td style="text-align:center"><code>insert()</code></td>
<td style="text-align:center">$O(logN)$</td>
<td style="text-align:center">$O(log N)$</td>
<td style="text-align:center">$O(logN)$</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">WC：$O(N)$</td>
<td style="text-align:center">WC：$O(log N)$</td>
<td style="text-align:center">WC：$O(log N)$</td>
</tr>
</tbody>
</table>
<p>说明：B树和LLRB是self-balanced（不会出现BST变成LinkedList的极端情况），所以比较快。</p>
<p>总的来说：</p>
<ul>
<li>B-trees的自平衡避免了BST的worst-cast complexity，</li>
<li>而LLRB不仅继承了B-trees的自平衡特性，还继承了BST易于实现的特点。</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2023-03-28</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/2023/hashing/">
			下回<br>61B Notes - Hashing
                </a>
                
                
                
                <a class="older-posts" href="/posts/2023/bst/">
			上回<br>61B Notes - ADT and BST
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












<script src="https://giscus.app/client.js"
        data-repo=""
        data-repo-id=""
        data-category=""
        data-category-id=""
        data-mapping=""
        data-strict=""
        data-reactions-enabled=""
        data-emit-metadata=""
        data-input-position=""
        data-theme=""
        data-lang=""
        crossorigin=""
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="http://eimy.ink/">
    
        <div class="nav-title">
            EIMY
        </div>
        
        <div class="nav-subtitle">
            The dots will connect.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            <a class="a-block nav-link-item false" href="/archives/">
                归档
            </a>
            
        
            
            
            
            <a class="a-block nav-link-item false" href="/categories/">
                分类
            </a>
            
        
            
            
            
            <a class="a-block nav-link-item false" href="/tags/">
                标签
            </a>
            
        
            
            
            
            <a class="a-block nav-link-item false" href="/about/">
                关于
            </a>
            
        
    </div>

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2026 EIMY
	

    </div>
</div>
<div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#b-tree-llrb" class="nav-b-tree-llrb">
									B-Tree, LLRB
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bst%e7%9a%84%e5%b1%80%e9%99%90" class="nav-bst的局限">
									BST的局限
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#b-trees--2-3-trees--2-3-4-trees" class="nav-b-trees--2-3-trees--2-3-4-trees">
									B-Trees / 2-3 trees / 2-3-4 trees
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%9a%e4%b9%89" class="nav-定义">
									定义
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9e%84%e6%88%90%e6%9c%ba%e5%88%b6" class="nav-构成机制">
									构成机制
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%a7%e8%b4%a8" class="nav-性质">
									性质
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#runtime-analysis" class="nav-runtime-analysis">
									Runtime Analysis
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#b-tree%e7%9a%84%e5%b1%80%e9%99%90" class="nav-b-tree的局限">
									B-Tree的局限
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#left-leaning-red-black-trees" class="nav-left-leaning-red-black-trees">
									Left Leaning Red-Black Trees
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%9a%e4%b9%89-1" class="nav-定义-1">
									定义
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%a7%e8%b4%a8-1" class="nav-性质-1">
									性质
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9e%84%e6%88%90%e6%9c%ba%e5%88%b6-1" class="nav-构成机制-1">
									构成机制
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" class="nav-代码实现">
									代码实现
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#runtime-analysis-1" class="nav-runtime-analysis-1">
									Runtime Analysis
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#summary-of-search-trees" class="nav-summary-of-search-trees">
									Summary of search trees
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%80%bb%e8%be%91%e6%a2%b3%e7%90%86" class="nav-逻辑梳理">
									逻辑梳理
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#complexityruntime%e5%af%b9%e6%af%94" class="nav-complexityruntime对比">
									Complexity/runtime对比
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2026 EIMY
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
