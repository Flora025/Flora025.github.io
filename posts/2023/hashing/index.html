<!DOCTYPE html>
<html translate="no" lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>61B Notes - Hashing | EIMY</title>
<meta name="keywords" content="数据结构">
<meta name="description" content="\hashbrown/\hashbrown/">
<meta name="author" content="fll">
<link rel="canonical" href="http://eimy.ink/posts/2023/hashing/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3f09ba765b9df309056d4698ef69e5ff8d1e95c6d19db8f6e8faedc07b090157.css" integrity="sha256-Pwm6dlud8wkFbUaY72nl/40elcbRnbj26PrtwHsJAVc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f83806d9904cccf883edf075a5ce1d71136879702650d07aca8c76361a3e467b.js" integrity="sha256-&#43;DgG2ZBMzPiD7fB1pc4dcRNoeXAmUNB6yox2Nho&#43;Rns="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://eimy.ink/favicons/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://eimy.ink/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://eimy.ink/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://eimy.ink/apple-touch-icon.png">
<link rel="mask-icon" href="http://eimy.ink/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://eimy.ink/posts/2023/hashing/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false}
                ]
            });
        });
    </script><meta property="og:title" content="61B Notes - Hashing" />
<meta property="og:description" content="\hashbrown/\hashbrown/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://eimy.ink/posts/2023/hashing/" /><meta property="og:image" content="http://eimy.ink/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-31T20:35:43+08:00" />
<meta property="article:modified_time" content="2023-03-31T20:35:43+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://eimy.ink/papermod-cover.png"/>

<meta name="twitter:title" content="61B Notes - Hashing"/>
<meta name="twitter:description" content="\hashbrown/\hashbrown/"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://eimy.ink/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "61B Notes - Hashing",
      "item": "http://eimy.ink/posts/2023/hashing/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "61B Notes - Hashing",
  "name": "61B Notes - Hashing",
  "description": "\\hashbrown/\\hashbrown/",
  "keywords": [
    "数据结构"
  ],
  "articleBody": "Hashing 这一课笔记的逻辑结构和课件略有区别，总体根据最初设定的两个优化目标分为两部分。\n第一部分找到一种数据结构（hash table），解决了search tree的generalization的问题；第二部分优化这个结构，解决了performance的问题。\nLimits of Search Tree sets requires the objects to be comparable performance not good enough (Θ(log N)) 因此之后的改进主要在这两方面：1）generalize to more types of objects；2）节约内存、降低复杂度。\nGeneralization to various objects 第一部分找到一种数据结构（hash table），解决了search tree的generalization的问题\nA Better Structure: Data Indexed Sets 这一部分从generalization入手，从Data Indexed Integer Set (Int -\u003e index）引入，扩展到Data Indexed English Word Set（EN word -\u003e Int -\u003e index），最后一步步generalize到Data Indexed String Set（String -(based on ASCII)-\u003e Int -\u003e index）。\n首先想到的是Data Indexed Integer Set 缺点是它太浪费memory了，并且无法表示除了integer以外的其他对象 其次，为了能够表示其他种类的对象，通过进制转换将字母转换成integer的index。 在进制的选择上，为了防止index重复（collision），选择base \u003e= N（item种类） 比如将27作为base转换26个字母 因此就有了Data Indexed English Word Set。 缺点是这个方法无法应对字符（“eGg!”） 为了进一步从英文单词generalize到字符，采用ASCII码/Unicode将String转化为index。 于是进化出了Data Indexed String Set 缺点是index过大，会造成overflow，超过java的限制（+2,147,483,647）。 而overflow会进一步导致index重复（collision） 为了“解决”这个generalization部分的遗留问题，将引入hash code的编码方式。\nHandling Collision: Hash Code and Hash Table Definition:\na hash code “projects a value from a set with many (or\neven an infinite number of) members to a value from a set with a fixed\nnumber of (fewer) members.”\n首先“解决”刚才的overflow导致collision的问题。 turns out collision无法避免，只能应对。\n应对方法是把hashcode相同的item放进一个bucket。可以用LinkedList、ArrayList、ArraySet等等。 bucket在示意图里是每一个index格子所指向的一筐item。 于是它又进化成了Separate Chaining Data Indexed Array 终于处理好了collision——这也意味着generalization部分的问题至此彻底解决。\nImproving Performance 第二部分优化hash table的结构，解决了performance的问题\n接下来就是开头的第二个问题performance（memory \u0026 complexity）。\n这个问题可以分解为两部分，一是几万个bucket太浪费memory，二是complexity可能会很高（比如所有的item都连成了一串）。\nSaving Memory 为了节约memory，改成只用N个bucket。\n方法是HashCode % NumBuckets把hashCode重新归档。比如，只用10个bucket，就把hashCode%10：\n以上完成的就是Hash Table。完整流程示意图如下：\nReducing Complexity 为了让每个bucket里的平均item数量保持恒定，需要动态改变bucket数量——resizing。\n具体来说，\n已知N为item总数，M为bucket总数 设定load factor = N / M （即最多平均每个bucket里有几个item） 下为示意图，如果load factor ≥ 1.5，将bucket数M翻倍：\nFinale: Hash Table Runtime Analysis Worst Case Runtime:\ncontains(x) add(x) Bushy BSTs Θ(log N) Θ(log N) DataIndexedArray Θ(1) Θ(1) Separate Chaining Hash Table With No Resizing Θ(N) Θ(N) … With Resizing Θ(1)† Θ(1)*† *: Indicates “on average”. †: Assuming items are evenly spread. 这里尤其要注意，如果hashCode()不好（无法平均分配items），那么还是会像without resizing的HT一样有Θ(N)。\n有了resizing后，worst case operation数\n不再是遍历全部连成一串的N个item【$\\Theta(N)$】 而是遍历最多N/M个item【$\\Theta(N/M) = \\Theta(1)$】 由此performance的问题也解决了。\n(Op) How to Compute a hashCode Q: How to write a good hashCode() method?\nA: Use a small prime base, for it yields better randomness and cost less to compute\n下面是两个hashCode()方法的例子：\n1 2 3 4 5 6 7 8 9 10 // Hashing a collection @Override public int hashCode() { int hashCode = 1; for (Object o : this) { hashCode = hashCode * 31; // elevate the current hash code hashCode = hashCode + o.hashCode(); // add new item’s hash code } return hashCode; } 1 2 3 4 5 6 7 8 9 10 // Hashing a recursive structure (e.g. a tree) @Override public int hashCode() { if (this.value == null) { return 0; } return this.value.hashCode() + 31 * this.left.hashCode() + 31 * 31 * this.right.hashCode(); } ",
  "wordCount" : "357",
  "inLanguage": "zh",
  "datePublished": "2023-03-31T20:35:43+08:00",
  "dateModified": "2023-03-31T20:35:43+08:00",
  "author":{
    "@type": "Person",
    "name": "fll"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://eimy.ink/posts/2023/hashing/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "EIMY",
    "logo": {
      "@type": "ImageObject",
      "url": "http://eimy.ink/favicons/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://eimy.ink/" accesskey="h" title="EIMY (Alt + H)">EIMY</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://eimy.ink/en/" title="English"
                            aria-label="English">English</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://eimy.ink/archives" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://eimy.ink/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://eimy.ink/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://eimy.ink/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://eimy.ink/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://eimy.ink/">主页</a>&nbsp;»&nbsp;<a href="http://eimy.ink/posts/">Posts</a></div>
    <h1 class="post-title">
      61B Notes - Hashing
    </h1>
    <div class="post-meta"><span title='2023-03-31 20:35:43 +0800 +0800'>三月 31, 2023</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;fll

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#hashing" aria-label="Hashing">Hashing</a><ul>
                            
                    <li>
                        <a href="#limits-of-search-tree-sets" aria-label="Limits of Search Tree sets">Limits of Search Tree sets</a></li>
                    <li>
                        <a href="#generalization-to-various-objects" aria-label="Generalization to various objects">Generalization to various objects</a><ul>
                            
                    <li>
                        <a href="#a-better-structure-data-indexed-sets" aria-label="A Better Structure: Data Indexed Sets">A Better Structure: Data Indexed Sets</a></li>
                    <li>
                        <a href="#handling-collision-hash-code-and-hash-table" aria-label="Handling Collision: Hash Code and Hash Table">Handling Collision: Hash Code and Hash Table</a></li></ul>
                    </li>
                    <li>
                        <a href="#improving-performance" aria-label="Improving Performance">Improving Performance</a><ul>
                            
                    <li>
                        <a href="#saving-memory" aria-label="Saving Memory">Saving Memory</a></li>
                    <li>
                        <a href="#reducing-complexity" aria-label="Reducing Complexity">Reducing Complexity</a></li></ul>
                    </li>
                    <li>
                        <a href="#finale-hash-table-runtime-analysis" aria-label="Finale: Hash Table Runtime Analysis">Finale: Hash Table Runtime Analysis</a></li>
                    <li>
                        <a href="#op-how-to-compute-a-hashcode" aria-label="(Op) How to Compute a hashCode">(Op) How to Compute a hashCode</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="hashing">Hashing<a hidden class="anchor" aria-hidden="true" href="#hashing">#</a></h1>
<p>这一课笔记的逻辑结构和课件略有区别，总体根据最初设定的两个优化目标分为两部分。</p>
<p>第一部分找到一种数据结构（hash table），解决了search tree的generalization的问题；第二部分优化这个结构，解决了performance的问题。</p>
<h2 id="limits-of-search-tree-sets">Limits of Search Tree sets<a hidden class="anchor" aria-hidden="true" href="#limits-of-search-tree-sets">#</a></h2>
<ul>
<li>requires the objects to be comparable</li>
<li>performance not good enough (Θ(log N))</li>
</ul>
<p>因此之后的改进主要在这两方面：<mark>1）generalize to more types of objects</mark>；<mark>2）节约内存、降低复杂度</mark>。</p>
<h2 id="generalization-to-various-objects">Generalization to various objects<a hidden class="anchor" aria-hidden="true" href="#generalization-to-various-objects">#</a></h2>
<blockquote>
<p>第一部分找到一种数据结构（hash table），解决了search tree的generalization的问题</p>
</blockquote>
<h3 id="a-better-structure-data-indexed-sets">A Better Structure: Data Indexed Sets<a hidden class="anchor" aria-hidden="true" href="#a-better-structure-data-indexed-sets">#</a></h3>
<p>这一部分从<mark>generalization</mark>入手，从<strong>Data Indexed Integer Set</strong> (Int -&gt; index）引入，扩展到<strong>Data Indexed English Word Set</strong>（EN word -&gt; Int -&gt; index），最后一步步generalize到<strong>Data Indexed String Set</strong>（String -(based on ASCII)-&gt; Int -&gt; index）。</p>
<ul>
<li>首先想到的是Data Indexed Integer Set
<ul>
<li>缺点是它太<strong>浪费memory</strong>了，并且<strong>无法表示</strong>除了integer以外的<strong>其他对象</strong></li>
</ul>
</li>
</ul>
<img src="./Hashing.assets/image-20230331184608386.png#center" alt="data indexed integer set" style="zoom:30%;" />
<ul>
<li>其次，为了能够表示其他种类的对象，通过进制转换将字母转换成integer的index。
<ul>
<li>在进制的选择上，为了防止index重复（collision），选择base &gt;= N（item种类）</li>
<li>比如将27作为base转换26个字母</li>
</ul>
</li>
<li>因此就有了Data Indexed English Word Set。
<ul>
<li>缺点是这个方法<strong>无法应对字符</strong>（“eGg!”）</li>
</ul>
</li>
</ul>
<img src="./Hashing.assets/image-20230331184931333.png#center" alt="~ english word set" style="zoom:30%;" />
<ul>
<li>为了进一步从英文单词generalize到字符，采用ASCII码/Unicode将String转化为index。</li>
<li>于是进化出了Data Indexed String Set
<ul>
<li>缺点是index过大，会造成<strong>overflow</strong>，超过java的限制（+2,147,483,647）。</li>
<li>而overflow会进一步导致index重复（<strong>collision</strong>）</li>
</ul>
</li>
</ul>
<img src="./Hashing.assets/image-20230331190320404.png#center" alt="Data Indexed String Set" style="zoom:33%;" />
<p>为了“解决”这个<mark>generalization</mark>部分的遗留问题，将引入hash code的编码方式。</p>
<h3 id="handling-collision-hash-code-and-hash-table">Handling Collision: Hash Code and Hash Table<a hidden class="anchor" aria-hidden="true" href="#handling-collision-hash-code-and-hash-table">#</a></h3>
<blockquote>
<p>Definition:</p>
<p>a hash code “<strong>projects</strong> a value from a set with many (or</p>
<p>even an infinite number of) members to a value from a set with a fixed</p>
<p>number of (fewer) members.”</p>
</blockquote>
<ul>
<li>首先“解决”刚才的overflow导致collision的问题。</li>
</ul>
<p>turns out <strong>collision无法避免，只能应对</strong>。</p>
<ul>
<li>应对方法是把hashcode相同的item放进一个<strong>bucket</strong>。可以用LinkedList、ArrayList、ArraySet等等。
<ul>
<li>bucket在示意图里是每一个index格子所指向的一筐item。</li>
</ul>
</li>
<li>于是它又进化成了<strong>Separate Chaining Data Indexed Array</strong></li>
</ul>
<img src="./Hashing.assets/image-20230331192023993.png#center" alt="buckets" style="zoom:50%;" />
<img src="./Hashing.assets/image-20230331193729555.png#center" alt="Separate Chaining Data Indexed Array" style="zoom:50%;" />
<p>终于处理好了collision——这也意味着<mark>generalization</mark>部分的问题至此彻底解决。</p>
<h2 id="improving-performance">Improving Performance<a hidden class="anchor" aria-hidden="true" href="#improving-performance">#</a></h2>
<blockquote>
<p>第二部分优化hash table的结构，解决了performance的问题</p>
</blockquote>
<p>接下来就是开头的第二个问题<mark>performance（memory &amp; complexity）</mark>。</p>
<p>这个问题可以分解为两部分，一是几万个bucket太<strong>浪费memory</strong>，二是<strong>complexity可能会很高</strong>（比如所有的item都连成了一串）。</p>
<h3 id="saving-memory">Saving Memory<a hidden class="anchor" aria-hidden="true" href="#saving-memory">#</a></h3>
<p>为了节约memory，改成只用N个bucket。</p>
<p>方法是HashCode % NumBuckets把hashCode重新归档。比如，只用10个bucket，就把hashCode%10：</p>
<img src="./Hashing.assets/image-20230331200830409.png#center" alt="using 10 buckets" style="zoom:33%;" />
<p>以上完成的就是Hash Table。完整流程示意图如下：</p>
<img src="./Hashing.assets/image-20230331200118828.png#center" alt="Hash Table" style="zoom: 40%;" />
<h3 id="reducing-complexity">Reducing Complexity<a hidden class="anchor" aria-hidden="true" href="#reducing-complexity">#</a></h3>
<p>为了让每个bucket里的平均item数量保持恒定，需要动态改变bucket数量——resizing。</p>
<p>具体来说，</p>
<ul>
<li>已知N为item总数，M为bucket总数</li>
<li>设定load factor = N / M （即最多平均每个bucket里有几个item）</li>
</ul>
<p>下为示意图，如果load factor ≥ 1.5，将bucket数M翻倍：</p>
<img src="./Hashing.assets/image-20230331201905735.png#center" alt="image-20230331201905735" style="zoom: 33%;" />
<h2 id="finale-hash-table-runtime-analysis">Finale: Hash Table Runtime Analysis<a hidden class="anchor" aria-hidden="true" href="#finale-hash-table-runtime-analysis">#</a></h2>
<p>Worst Case Runtime:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">contains(x)</th>
<th style="text-align:center">add(x)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Bushy BSTs</td>
<td style="text-align:center">Θ(log N)</td>
<td style="text-align:center">Θ(log N)</td>
</tr>
<tr>
<td style="text-align:center">DataIndexedArray</td>
<td style="text-align:center">Θ(1)</td>
<td style="text-align:center">Θ(1)</td>
</tr>
<tr>
<td style="text-align:center">Separate Chaining Hash Table With No Resizing</td>
<td style="text-align:center">Θ(N)</td>
<td style="text-align:center">Θ(N)</td>
</tr>
<tr>
<td style="text-align:center">&hellip; With Resizing</td>
<td style="text-align:center">Θ(1)†</td>
<td style="text-align:center">Θ(1)*†</td>
</tr>
</tbody>
</table>
<p>*: Indicates “on average”.
†: Assuming items are evenly spread. 这里尤其要注意，如果hashCode()不好（无法平均分配items），那么还是会像without resizing的HT一样有Θ(N)。</p>
<p>有了resizing后，worst case operation数</p>
<ul>
<li>不再是遍历全部连成一串的N个item【$\Theta(N)$】</li>
<li>而是遍历最多N/M个item【$\Theta(N/M) = \Theta(1)$】</li>
</ul>
<p>由此<mark>performance</mark>的问题也解决了。</p>
<h2 id="op-how-to-compute-a-hashcode">(Op) How to Compute a hashCode<a hidden class="anchor" aria-hidden="true" href="#op-how-to-compute-a-hashcode">#</a></h2>
<p>Q: How to write a good <code>hashCode()</code> method?</p>
<p>A: Use a small <strong>prime base</strong>, for it yields better randomness and cost less to compute</p>
<p>下面是两个hashCode()方法的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Hashing a collection
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">hashCode</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">o</span> <span class="o">:</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashCode</span> <span class="o">=</span> <span class="n">hashCode</span> <span class="o">*</span> <span class="mi">31</span><span class="o">;</span> <span class="c1">// elevate the current hash code
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">hashCode</span> <span class="o">=</span> <span class="n">hashCode</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span> <span class="c1">// add new item’s hash code
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">hashCode</span><span class="o">;</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Hashing a recursive structure (e.g. a tree)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    	<span class="k">return</span> <span class="mi">0</span><span class="o">;</span> 
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">        <span class="mi">31</span> <span class="o">*</span> <span class="k">this</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    	<span class="mi">31</span> <span class="o">*</span> <span class="mi">31</span> <span class="o">*</span> <span class="k">this</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://eimy.ink/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://eimy.ink/posts/2023/undergrad-chronicle/">
    <span class="title">« 上一页</span>
    <br>
    <span>我的《本科择业编年史》</span>
  </a>
  <a class="next" href="http://eimy.ink/posts/2023/b-tree-llrb/">
    <span class="title">下一页 »</span>
    <br>
    <span>61B Notes - B-Trees &amp; LLRB</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://eimy.ink/">EIMY</a></span><span style="display: inline-block; margin-left: 1em;">
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/reorx/hugo-PaperMod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
  (function() {
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                behavior: "smooth"
            });
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
  })();
</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '复制';

        function copyingDone() {
            copybutton.innerText = '已复制！';
            setTimeout(() => {
                copybutton.innerText = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<script>
window.addEventListener('DOMContentLoaded', function (event) {
  const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
  const activeClass = 'active';

  
  let activeHeading = headings[0];
  getLinkByHeading(activeHeading).classList.add(activeClass);

  const onScroll = () => {
    const passedHeadings = [];
    for (const h of headings) {
      
      if (getOffsetTop(h) < 5) {
        passedHeadings.push(h)
      } else {
        break;
      }
    }
    if (passedHeadings.length > 0) {
      newActiveHeading = passedHeadings[passedHeadings.length - 1];
    } else {
      newActiveHeading = headings[0];
    }
    if (activeHeading != newActiveHeading) {
      getLinkByHeading(activeHeading).classList.remove(activeClass);
      activeHeading = newActiveHeading;
      getLinkByHeading(activeHeading).classList.add(activeClass);
    }
  }

  let timer = null;
  window.addEventListener('scroll', () => {
    if (timer !== null) {
      clearTimeout(timer)
    }
    timer = setTimeout(onScroll, 50)
  }, false);

  function getLinkByHeading(heading) {
    const id = encodeURI(heading.getAttribute('id')).toLowerCase();
    return document.querySelector(`.toc ul li a[href="#${id}"]`);
  }

  function getOffsetTop(heading) {
    if (!heading.getClientRects().length) {
      return 0;
    }
    let rect = heading.getBoundingClientRect();
    return rect.top
  }
}, false);
</script></body>

</html>
